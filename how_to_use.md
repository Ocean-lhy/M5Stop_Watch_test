# M5 StopWatch 产品测试固件使用说明

## 项目简介

这是用于 M5Stiack StopWatch 的产品测试测试固件，包含 26 个测试项目，用于验证硬件各个模块的功能。

## 硬件说明

### 按键定义
- **左键 (Button2)**: 菜单向下滚动 / 选项切换
- **右键 (Button1)**: 确认 / 进入测试 / 退出测试

### 触摸屏操作
- **上半部分 (y: 50-180)**: 菜单向上滚动
- **中间区域 (y: 181-279)**: 进入当前选中的测试
- **下半部分 (y: 280-410)**: 菜单向下滚动

## 测试项目说明

### 1. 设置 I2C 速率

**功能**: 设置 PMIC 和 PY32 的 I2C 通信速率

**操作**:
- 左键: 在 400 KHz 和 100 KHz 之间切换
- 右键: 确认并应用设置

**说明**: 测试 I2C 速率，设置结果可以通过串口打印查看。

---

### 2. 设置 Grove 5V

**功能**: 配置 Grove 接口的 5V 电源模式

**操作**:
- 左键: 在 INPUT 和 OUTPUT 模式之间切换
- 右键: 确认并应用设置

**说明**: 
- INPUT: 5V 作为输入（外部供电）
- OUTPUT: 5V 作为输出（对外供电）

---

### 3. 设置充电

**功能**: 配置电池充电模式

**操作**:
- 左键: 循环切换三种模式
  - 关闭充电
  - 输出高电平，慢充
  - 输出高电平，快充
- 右键: 确认并应用设置

**说明**: 测试充电速度。

---

### 4. 状态信息

**功能**: 实时显示系统电压信息

**显示内容**:
- VBAT: 电池电压
- VIN: 输入电压
- 5VIO: 5V IO 电压
- VREF: 参考电压

**操作**:
- 右键: 退出

**说明**: 用于监控设备的电源状态，所有电压单位为 mV。

---

### 5. 显示测试

**功能**: 测试屏幕显示功能

**操作**:
- 左键: 循环切换显示内容
  - 白屏
  - 红屏
  - 绿屏
  - 蓝屏
  - 红底白圆
  - 白底黑圆
- 右键: 退出

**说明**: 用于检测屏幕是否有坏点、亮点或显示异常。

---

### 6. 触摸测试

**功能**: 测试触摸屏的响应和精度

**操作**:
- 触摸屏幕: 绘制彩色轨迹
- 左键: 清空屏幕
- 右键: 退出

**显示信息**: 底部显示当前触摸坐标和状态

**说明**: 每次按下会生成新的随机颜色，移动时会连续绘制线条。

---

### 7. 录音测试

**功能**: 测试麦克风录音和 WiFi 传输功能

**操作流程**:
1. 左键开始录音（最长 30 秒）
2. 再次按左键或超时后停止录音
3. 自动连接 WiFi（SSID: M5Stack）
4. 显示下载地址 `http://设备IP/`
5. 左键: 本地播放录音
6. 右键: 退出并清理

**说明**: 录音完成后可通过浏览器访问显示的 IP 地址下载录音文件。

---

### 8. 播放测试

**功能**: 测试音频播放功能

**菜单项**:
1. **音量设置**: 0%, 25%, 50%, 75%, 100%
2. **功放开关**: 开启 / 关闭
3. **选择音频**: 歌曲 / 音频
4. **开始播放** / 暂停播放
5. **退出测试**

**操作**:
- 左键: 在主菜单移动光标，在子菜单调节参数
- 右键: 进入子菜单或确认操作

**显示**: 播放时显示进度条和时间信息

---

### 9. IMU 测试

**功能**: 测试 BMI270 六轴传感器

**显示内容**:
- 加速度数据 (ACC: x, y, z)
- 陀螺仪数据 (GYR: x, y, z)
- 3D 圆柱体实时旋转动画（根据设备姿态）

**操作**:
- 右键: 退出

**说明**: 旋转设备，屏幕上的 3D 圆柱体会实时跟随姿态变化。

---

### 10. RTC 时间

**功能**: 显示和同步 RTC 实时时钟

**显示内容**:
- 当前日期和时间
- WiFi 连接状态

**操作**:
- 左键: 通过 SNTP 同步网络时间
- 右键: 退出

**说明**: 首次同步会连接 WiFi（SSID: M5Stack）并从阿里云 NTP 服务器获取时间。

---

### 11. 振动测试

**功能**: 测试振动马达

**操作**:
- 左键: 循环增加振动强度（0% → 10% → ... → 100% → 0%）
- 右键: 退出（自动关闭振动）

**显示**: 当前振动强度百分比

---

### 12. Grove IO 测试

**功能**: 测试 Grove 接口的 GPIO 功能

**操作**:
- 右键: 退出

**显示**: 实时显示 GPIO3 和 GPIO4 的电平状态

**说明**: GPIO3 和 GPIO4 每 500ms 自动翻转电平，可用示波器或万用表测量。

---

### 13. 底部 IO 测试

**功能**: 测试底部接口的 GPIO（GPIO3-GPIO9）

**操作**:
- 右键: 退出

**显示**: 当前输出高电平的 GPIO 编号

**说明**: 每 500ms 轮流将 GPIO3-9 拉高，其他 GPIO 拉低。

---

### 14. CH442E 设置

**功能**: 测试 CH442E 多路复用器控制

**操作**:
- 左键: 切换控制电平（HIGH / LOW）
- 右键: 退出

**显示**: 当前电平状态

---

### 15. WiFi 扫描

**功能**: 扫描周围的 WiFi 热点

**操作**:
- 右键: 退出

**显示**: 
- 自动每 3 秒扫描一次
- 显示最多 10 个热点的 SSID 和信号强度（RSSI）

---

### 16. WiFi 拉距测试

**功能**: 测试 WiFi 信号强度和通信质量

**配置**:
- SSID: M5-WiFi-Test
- Password: M5NETWORKTEST
- 目标服务器: 192.168.3.5:12345 (UDP)

**显示内容**:
- 设备 IP 地址
- 实时 RSSI 信号强度（dBm）
- 信号强度条
- 发送数据包计数（TX）
- 接收数据包计数（RX）

**操作**:
- 右键: 退出

**说明**: 
- 每秒向目标服务器发送 "Hello"
- 接收到 "OK" 响应时 RX 计数增加
- 信号颜色: 绿色（良好）、黄色（中等）、红色（差）

---

### 17. L0 关机

**功能**: 进入 L0 低功耗模式（关机）

**操作**: 进入后 3 秒倒计时，自动关闭所有外设并关机

**说明**: 这是最低功耗模式，需要按电源键或外部唤醒才能重启。

---

### 18. L1 待机

**功能**: 进入 L1 低功耗模式（待机）

**操作**: 进入后 3 秒倒计时，保持 IMU 和 RTC 运行，其他外设关闭

**说明**: 比 L0 功耗稍高，但保持传感器运行，可快速唤醒。

---

### 19. L2 睡眠

**功能**: 进入 L2 低功耗模式（深度睡眠）

**操作**: 进入后 3 秒倒计时，ESP32-S3 进入 Deep Sleep

**说明**: CPU 休眠，可通过外部中断唤醒。

---

### 20. IMU 唤醒 L2

**功能**: 测试 IMU 唤醒功能（从 L2 模式）

**操作**: 进入后 3 秒倒计时，ESP32-S3 进入 Deep Sleep

**唤醒方式**: 晃动设备触发 IMU 中断

---

### 21. IMU 唤醒 L1

**功能**: 测试 IMU 唤醒功能（从 L1 关机模式）

**操作**: 进入后 3 秒倒计时，设备关机

**唤醒方式**: 晃动设备触发 IMU 中断

---

### 22. RTC 唤醒 L2

**功能**: 测试 RTC 定时唤醒功能（从 L2 模式）

**操作**: 进入后 3 秒倒计时，ESP32-S3 进入 Deep Sleep

**唤醒方式**: 10 秒后 RTC 自动唤醒

---

### 23. RTC 唤醒 L1

**功能**: 测试 RTC 定时唤醒功能（从 L1 关机模式）

**操作**: 进入后 3 秒倒计时，设备关机

**唤醒方式**: 10 秒后 RTC 自动唤醒

---

### 24. 底座插入唤醒

**功能**: 测试底座 5V 插入唤醒功能

**操作**: 进入后 3 秒倒计时，设备关机

**唤醒方式**: 插入底座或 USB 供电

---

### 25. 满载测试

**功能**: 所有外设同时运行，测试最大功耗

**运行内容**:
- 屏幕全白显示
- 振动马达 100% 功率
- WiFi 每 3 秒扫描一次
- 音频 100% 音量循环播放

**操作**:
- 右键: 退出

**说明**: 用于功耗测试和散热测试。

---

### 26. 老化测试

**功能**: 长时间运行测试，用于产品老化

**运行内容**:
- 自动连接 WiFi（SSID: M5Stack）
- 循环刷新显示
- 监控电池电压，低于 3800mV 自动关机

**操作**:
- 右键: 退出

**说明**: 用于长时间耗电测试，为了不发出噪音所以关闭了音频和振动。

---

## WiFi 配置

### 常规功能 WiFi
- **SSID**: M5Stack
- **Password**: m5office888
- **用途**: 录音下载、RTC 时间同步

### 拉距测试 WiFi
- **SSID**: M5-WiFi-Test
- **Password**: M5NETWORKTEST
- **目标服务器**: 192.168.3.5:12345

---
